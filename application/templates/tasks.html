<html lang="lt">
<head>
    <title>Štabo konsolė: užduotys</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="/assets/js/task.js"></script>
    <script src="/assets/js/tasks-component.js"></script>
    <script src="/assets/js/dispatcher.js"></script>
    <script src="/assets/js/participant.js"></script>
    <script type="application/javascript">

        // TODO move to the tasks list component
        function initializeTasks(dispatcher) {
            let tasksComponent = new TasksComponent(dispatcher);
            tasksComponent.addTask(
                (new Task("Prepare to commendant hour squad I", 1, new Date()))
                    .setStatus("new")
                    .setSender(1)
                    .setReceivers([1, 2])
                    .setResult('aaa')
                    .setDispatcher(dispatcher)
            );
            tasksComponent.addTask(
                (new Task("Prepare to commendant hour squad II", 2, new Date()))
                    .setStatus("sent")
                    .setSender(2)
                    .setReceivers([2, 3])
                    .setResult('bbb')
                    .setDispatcher(dispatcher)
            );
            tasksComponent.addTask(
                (new Task("Prepare to commendant hour squad III", 3, new Date()))
                    .setStatus("received")
                    .setSender(3)
                    .setReceivers([1, 3])
                    .setResult('ccc')
                    .setDispatcher(dispatcher)
            );

            return tasksComponent;
        }
    </script>
</head>
<body>
Prototype

<div id="app">
    <div id="tasksList">

    </div>
    <div id="taskDetails2">
    </div>
</div>
<script type="application/javascript">
    let dispatcher = new Dispatcher();

    let tasksComponent = initializeTasks(dispatcher);


    let redrawTasksList = () => {
        let tasksListDiv = document.getElementById('tasksList');
        clearTag(tasksListDiv);
        tasksListDiv.appendChild(tasksComponent.renderTasks());
    }

    redrawTasksList();

    // =================== events initialization ===================================
    // TODO vėliau perkelsim į atskirą funkciją
    // TODO use constants for event names ?

    const taskDetailsOuterDiv = document.getElementById('taskDetails2')
    dispatcher.addListener('taskSaved', (task) => {
        console.log('Task saved ' + task.id)
        redrawTasksList()
    })
    dispatcher.addListener('taskDetailsRendered', (taskInnerDiv) => {
        clearTag(taskDetailsOuterDiv)
        taskDetailsOuterDiv.appendChild(taskInnerDiv)
    })

    dispatcher.addListener('deleteTaskPressed', ([e, taskId]) => tasksComponent.deleteTask(e, taskId))
    dispatcher.addListener('onAddTask', () => {
        redrawTasksList();
    })

    dispatcher.addListener('afterDeleteTask', (taskId) => {
        redrawTasksList();
    })

    // =============================================================================

</script>
</body>
</html>